name: 'Ensure GTK4'
author: 'Sebastian Pape'
description: 'This will add GVSBuild to the path on Windows and install the packages on MacOS and Linux'
branding:
  icon: 'package'
  color: 'blue'

inputs:
  windows-release:
    description: 'Release Tag. Either "latest" or e.g. "tags/2025.4.0"'
    required: true
    default: 'latest'
  windows-gtk-version:
    description: 'Wildcard used to match filenames, but can be used to switch to eg. GTK3'
    required: true
    default: 'GTK4*.zip'
  linux-release:
    description: 'APT-Package Name for Ubuntu'
    required: true
    default: 'libgtk-4-dev'
  macos-release:
    description: 'Homebrew-Package Name for MacOS'
    required: true
    default: 'gtk4'
  
runs:
  using: "composite"
  steps:
    - name: 'Install Package in Linux'
      if: runner.os == 'Linux'
      shell: bash
      run: sudo apt update && sudo apt install -y ${{ inputs.linux-release }}
    - name: 'Install Package in MacOS'
      if: runner.os == 'macOS'
      shell: bash
      run: brew install ${{ inputs.macos-release }}
    - name: 'Download, Extract and Add to Path Windows'
      if: runner.os == 'Windows'
      shell: powershell
      run: |
        (Invoke-RestMethod -Uri https://api.github.com/repos/wingtk/gvsbuild/releases/${{ inputs.windows-release }} -ContentType "application/json").assets | foreach {
        	if( $_.name -like "${{ inputs.windows-gtk-version }}" ){$download = $_.browser_download_url}
        }
        if($download){
        	(Invoke-WebRequest -OutFile gtk.zip $download) -and (Expand-Archive -Path gtk.zip -DestinationPath "C:\gtk4") -and (rm .\gtk.zip)
        	$Env:PATH += "C:\gtk\bin;"
        } else {
        	echo "Could not find matching file"
        }
